<!DOCTYPE html>
<html>
<head>
  <title>SeaScreen Settings</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #222;
      color: white;
      padding: 20px;
    }
    #notice {
      margin-top: 20px;
      font-size: 14px;
      color: #ffcc00;
    }
  </style>
</head>
<body>
  <h1>SeaScreen Settings</h1>
  
  <label for="timeout">Inactivity Timeout (minutes):</label>
  <input type="number" id="timeout" min="1" max="60">
  
  <br><br>
  
  <label for="kioskMode">Launch Instantly - Kiosk/Devs:</label>
  <input type="checkbox" id="kioskMode">
  
  <br><br>
  
  <button id="saveButton">Save</button>
  <p id="notice">Close this window to reactivate the screensaver.</p>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        console.log("‚öôÔ∏è Loading settings...");
        const settings = await window.electronAPI.invoke("load-settings");
        console.log("‚úÖ Settings loaded:", settings);

        if (settings) {
          document.getElementById("timeout").value = settings.inactivityTimeout / 60000;
          document.getElementById("kioskMode").checked = settings.kioskMode || true;
        }
      } catch (error) {
        console.error("‚ùå Error loading settings:", error);
      }
    });

    document.getElementById("saveButton").addEventListener("click", () => {
      const timeout = document.getElementById("timeout").value * 60000;
      const kioskMode = document.getElementById("kioskMode").checked;

      console.log("üíæ Saving settings:", { inactivityTimeout: timeout, kioskMode });
      window.electronAPI.send("save-settings", { inactivityTimeout: timeout, kioskMode });

      // Notify main process to apply settings immediately
      window.electronAPI.send("apply-settings", { inactivityTimeout: timeout, kioskMode });
    });

    // ‚úÖ Prevent black screen issue after settings close
    window.addEventListener("beforeunload", () => {
      console.log("‚öôÔ∏è Settings window closed.");
      window.electronAPI.send("settings-closed");
    });
  </script>
</body>
</html>